{"version":3,"file":"script.js","mappings":"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","sources":["webpack://wp-query-block-extension-metadata-sort/external window \"ReactJSXRuntime\"","webpack://wp-query-block-extension-metadata-sort/webpack/bootstrap","webpack://wp-query-block-extension-metadata-sort/webpack/runtime/compat get default export","webpack://wp-query-block-extension-metadata-sort/webpack/runtime/define property getters","webpack://wp-query-block-extension-metadata-sort/webpack/runtime/hasOwnProperty shorthand","webpack://wp-query-block-extension-metadata-sort/webpack/runtime/make namespace object","webpack://wp-query-block-extension-metadata-sort/./src/script.js"],"sourcesContent":["module.exports = window[\"ReactJSXRuntime\"];","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const { createHigherOrderComponent } = wp.compose;\nconst { Fragment, useEffect, useState } = wp.element;\nconst { InspectorControls } = wp.blockEditor;\nconst { PanelBody, ToggleControl, PanelRow, TextControl, SelectControl } = wp.components;\n\n/**\n * Add additional attributes to core/post-query block.\n */\nfunction addAdditionalAttribute( settings, name ) {\n    if ( 'core/query' !== name ) {\n        return settings;\n    }\n\n    return {\n        ...settings,\n        attributes: {\n            ...settings.attributes,\n            metaSortEnabled: {\n                type: 'boolean',\n                default: false\n            }\n        }\n    }\n}\n\nwp.hooks.addFilter(\n    'blocks.registerBlockType',\n    'query-block-extension/metadata/sort/add-attributes',\n    addAdditionalAttribute\n);\n\n/**\n * Add additional controls to core/post-template block.\n */\nconst withInspectorControls = createHigherOrderComponent( ( BlockEdit ) => {\n    return ( props ) => {\n        const { name, attributes, setAttributes } = props;\n        const { metaSortEnabled, query } = attributes;\n        const [ metaKeys, setMetaKeys ] = useState([]);\n\n        if( 'core/query' !== name ) {\n            return <BlockEdit { ...props } />;\n        }\n\n        useEffect(() => {\n\t\t\tconst fetchMetaKeys = async () => {\n\t\t\t\tconst postType = query?.postType || 'post'; // Fallback to 'post'\n\t\t\n\t\t\t\tconst data = new FormData();\n\t\t\t\tdata.append('action', 'metadata_sort_get_meta_keys');\n\t\t\t\tdata.append('nonce', wp_query_block_metadata_sort.nonce);\n\t\t\t\tdata.append('post_type', postType);\n\t\t\n\t\t\t\tconst response = await fetch(ajaxurl, {\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tcredentials: 'same-origin',\n\t\t\t\t\tbody: data\n\t\t\t\t});\n\t\t\n\t\t\t\tconst responseJson = await response.json();\n\t\t\t\tif (responseJson.success) {\n\t\t\t\t\tsetMetaKeys(responseJson.data);\n\t\t\t\t}\n\t\t\t};\n\t\t\n\t\t\tfetchMetaKeys();\n\t\t}, [query?.postType]);\n\t\t\n\n        const disableMetaSort = () => {\n            const { ['metaKey']: remove, ...rest } = query;\n            setAttributes({\n                metaSortEnabled: false,\n                query: {\n                    ...rest,\n                    orderBy: 'date',\n                    order: 'desc'\n                }\n            });\n        }\n\n        const enableMetaSort = () => {\n            setAttributes({\n                metaSortEnabled: true,\n                query: {\n                    ...query,\n                    orderBy: 'meta_value',\n                    order: 'desc',\n                    metaKey: metaKeys[0]\n                }\n            });\n        }\n\n        useEffect(() => {\n            // If user select one of the default query block orderBy value, then we disable meta sort.\n            if ( ! query.orderBy.startsWith('meta_value') && metaSortEnabled ) {\n                disableMetaSort();\n            }\n        }, [query.orderBy]);\n\n        return (\n            <Fragment>\n                <BlockEdit { ...props } />\n                <InspectorControls>\n                    <PanelBody title=\"Metadata Sort\" initialOpen={ false }>\n                    { metaKeys.length > 0 ? (\n                        <Fragment>\n                            <ToggleControl\n                            label=\"Enable Metadata Sort\"\n                            checked={ metaSortEnabled }\n                            onChange={ newMetaSortEnabled => {\n                                if( newMetaSortEnabled ) {\n                                    enableMetaSort();\n                                } else {\n                                    disableMetaSort();\n                                }\n                            } }\n                        />\n                        { metaSortEnabled ? (\n                            <Fragment>\n                                <SelectControl\n                                    label=\"Meta Type\"\n                                    value={ query.metaType ? query.metaType : 'CHAR' }\n                                    options={ [\n                                        { label: 'Char', value: 'CHAR' },\n                                        { label: 'Numeric', value: 'NUMERIC' },\n                                        { label: 'Binary', value: 'BINARY' },\n                                        { label: 'Date', value: 'DATE' },\n                                        { label: 'DateTime', value: 'DATETIME' },\n                                        { label: 'Decimal', value: 'DECIMAL' },\n                                        { label: 'Signed', value: 'SIGNED' },\n                                        { label: 'Time', value: 'TIME' },\n                                        { label: 'Unsigned', value: 'UNSIGNED' }\n                                    ] }\n                                    onChange={ ( newType ) => {\n                                        setAttributes({\n                                            query: {\n                                                ...query,\n                                                metaType: newType,\n                                            }\n                                        });\n                                    } }\n                                />\n                                <SelectControl\n                                    label=\"Order\"\n                                    value={ query.order }\n                                    options={ [\n                                        { label: 'DESC', value: 'desc' },\n                                        { label: 'ASC', value: 'asc' }\n                                    ] }\n                                    onChange={ ( newOrder ) => {\n                                        setAttributes({\n                                            query: {\n                                                ...query,\n                                                order: newOrder\n                                            }\n                                        });\n                                    } }\n                                />\n                                <SelectControl\n                                    label=\"Meta Key\"\n                                    value={ query.metaKey }\n                                    options={ metaKeys.map(key => {\n                                        return {\n                                            label: key,\n                                            value: key\n                                        };\n                                    }) }\n                                    onChange={ ( newMetaKey ) => {\n                                        setAttributes({\n                                            query: {\n                                                ...query,\n                                                metaKey: newMetaKey\n                                            }\n                                        });\n                                    } }\n                                    __nextHasNoMarginBottom\n                                />\n                            </Fragment>\n                        ) : null }\n                        </Fragment>\n                    ) : (\n                            <p>No post meta key detected on your site</p>\n                        )\n                    }\n                    </PanelBody>\n                </InspectorControls>\n            </Fragment>\n        );\n    };\n}, 'withInspectorControl' );\n\nwp.hooks.addFilter(\n    'editor.BlockEdit',\n    'query-block-extension/metadata/sort/add-controls',\n    withInspectorControls\n);"],"names":["createHigherOrderComponent","wp","compose","Fragment","useEffect","useState","element","InspectorControls","blockEditor","PanelBody","ToggleControl","PanelRow","TextControl","SelectControl","components","addAdditionalAttribute","settings","name","attributes","metaSortEnabled","type","default","hooks","addFilter","withInspectorControls","BlockEdit","props","setAttributes","query","metaKeys","setMetaKeys","_jsx","fetchMetaKeys","postType","data","FormData","append","wp_query_block_metadata_sort","nonce","response","fetch","ajaxurl","method","credentials","body","responseJson","json","success","disableMetaSort","remove","rest","orderBy","order","enableMetaSort","metaKey","startsWith","_jsxs","children","title","initialOpen","length","label","checked","onChange","newMetaSortEnabled","value","metaType","options","newType","newOrder","map","key","newMetaKey","__nextHasNoMarginBottom"],"sourceRoot":""}